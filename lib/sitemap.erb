<?xml version="1.0" encoding="UTF-8"?>

<% if page.xsl %>
  <?xml-stylesheet type="text/xsl" href="/sitemap.xsl"?>
<% end %>

<urlset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd" xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <% output_collection_names = site.config.collections.select { |name, data| data.output }.keys %>
  <% collections.slice(output_collection_names).each do |collection| %>
    <% collection.resources.each do |resource| %>
      <% next if resource.data.title == "404" %>
      <url>
        <% url = url_for resource.absolute_url.delete_suffix("index.html") %>
        <loc><%= Bridgetown::Utils.xml_escape url %></loc>
        <lastmod><%= resource.last_modified_at.localtime.xmlschema %></lastmod>
      </url>
    <% end %>
  <% end %>

  <!-- Add site.generated_pages -->

  <% site.static_files.each do |file| %>
    <url>
      <% url = url_for file.relative_path %>
      <loc><%= Bridgetown::Utils.xml_escape url %></loc>
      <lastmod><%= file.modified_time.localtime.xmlschema %></lastmod>
    </url>
  <% end %>
</urlset>
